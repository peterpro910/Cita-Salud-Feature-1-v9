<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Citas Médicas</title>
    <link rel="stylesheet" href="../css/citas.css?v=2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>

<body>
    <header>
        <h1>
            <i class="fa-solid fa-user-doctor"></i>
            Mis Citas Médicas
        </h1>


        <nav class="main-nav">
            <ul>
                <li><a href="agendar_cita.html"><i class="fas fa-calendar-plus"></i> Agendar Cita</a></li>
                <li><a href="citas.html" class="active"><i class="fas fa-calendar-times"></i>Mis Citas</a>
                <li><a href="estadisticas.html" class="active"><i class="fas fa-chart-bar"></i>Estadísticas de
                        Asistencia</a></li>
                <li><a href="#" id="logout-link"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <div id="mensaje" class="mensaje" role="status"></div>
        
        <div class="filtros-wrapper" style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 10px;">

            <div class="filtros-estado-container" style="display: flex; align-items: center; gap: 15px;">
                <label for="filtro-estado" style="font-weight: bold;">Filtrar por estado:</label>
                <select id="filtro-estado" aria-label="Filtrar citas por estado" style="padding: 5px; min-height: 44px;">
                    </select>
                <button id="btn-limpiar-filtro" class="btn-accion btn-secundario" style="padding: 5px 10px; cursor: pointer; min-height: 44px;">Limpiar Estado</button>
            </div>

            <div class="filtros-especialidad-container" style="display: flex; align-items: center; gap: 15px;">
                <label for="filtro-especialidad" style="font-weight: bold;">Filtrar por especialidad:</label>
                
                <select id="filtro-especialidad" aria-label="Filtrar citas por especialidad médica" style="padding: 5px; min-height: 44px;" tabindex="0">
                    <option value="todas">Todas las especialidades</option> 
                </select>
                
                <button id="btn-limpiar-filtro-especialidad" class="btn-accion btn-secundario" style="padding: 5px 10px; cursor: pointer; min-height: 44px;">Limpiar Especialidad</button>
            </div>
        </div> 

        <div id="mensaje-lista-vacia" style="display: none; text-align: center; padding: 20px; background-color: #fff; border: 1px solid #eee; border-radius: 8px; margin-top: 10px;">
        </div>

        <div class="citas-grid-container">
            <div id="citas-container">
            </div>
        </div>
    </main>

    <div id="modal-detalle-cita" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title"
        tabindex="-1">
        <div class="modal-content">
            <button class="close-modal-btn" data-modal="detalle" aria-label="Cerrar ventana modal"
                tabindex="0">&times;</button>
            <div id="modal-info-body">
            </div>
        </div>
    </div>

    <div id="modal-mensaje" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-titulo" tabindex="-1"
        style="display: none;">
        <div class="modal-content">
            <h2 id="modal-titulo"></h2>
            <p id="modal-texto"></p>
            <div class="card-actions full-width">
                <button id="modal-cerrar-btn" class="btn-accion btn-modificar">Cerrar</button>
            </div>
        </div>
    </div>

    <div id="modal-cancelacion" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-cancelacion-title"
        tabindex="-1" style="display: none;">
        <div class="modal-content">
            <button id="btn-cerrar-cancelacion" class="close-modal-btn"
                aria-label="Cerrar ventana de selección de motivo">&times;</button>
            <h2 id="modal-cancelacion-title"><i class="fas fa-user"></i> Seleccionar Motivo de Cancelación</h2>

            <form id="form-motivo-cancelacion">
                <div class="form-group">
                    <label for="motivo-select"><i class="fas fa-clipboard-list"></i> Motivo de Cancelación</label>
                    <select id="motivo-select" name="id_motivo" required aria-required="true" tabindex="0">
                        <option value="" disabled selected hidden>Cargando motivos...</option>
                    </select>
                </div>

                <div class="card-actions full-width">
                    <button type="submit" id="btn-continuar-cancelacion" class="btn-accion btn-danger" disabled>
                        Continuar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-resumen-cancelacion" class="modal" role="dialog" aria-modal="true"
        aria-labelledby="modal-resumen-title" tabindex="-1" style="display: none;">
        <div class="modal-content">
            <button id="btn-cerrar-resumen-cancelacion" class="close-modal-btn"
                aria-label="Cerrar ventana de selección de motivo">&times;</button>
            <h2 id="modal-resumen-title">Confirmar Cancelación</h2>

            <div class="resumen-cita-container">
                <h3>Resumen de la Cita</h3>
                <p><strong>Especialidad:</strong> <span id="resumen-especialidad"></span></p>
                <p><strong>Fecha:</strong> <span id="resumen-fecha"></span></p>
                <p><strong>Hora:</strong> <span id="resumen-hora"></span></p>
                <p><strong>Profesional:</strong> <span id="resumen-profesional"></span></p>
                <p><strong>Sede:</strong> <span id="resumen-sede"></span></p>
                <hr>
                <h3>Motivo y Límite</h3>
                <p><strong>Motivo Seleccionado:</strong> <span id="resumen-motivo-seleccionado"
                        class="motivo-resaltado"></span></p>
                <p id="resumen-cancelaciones-mes"></p>
            </div>


            <div class="card-actions full-width">
                <button id="btn-modificar-motivo" class="btn-accion btn-modificar"
                    aria-label="Volver para modificar el motivo">
                    Modificar Motivo
                </button>
                <button id="btn-confirmar-cancelacion" class="btn-accion btn-danger"
                    aria-label="Confirmar la cancelación final de la cita">
                    Confirmar Cancelación
                </button>
            </div>
        </div>
    </div>

    <div id="modificationModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modModalTitle"
        tabindex="-1" style="display: none;">
        <div class="modal-content large-modal">
            <span id="cancelModification" class="close-modal-btn"
                aria-label="Cerrar ventana de modificación">&times;</span>
            <h2 id="modModalTitle">Modificar Cita <span id="cita_id_display"></span></h2>

            <div id="modificationForm">
                <h3>
                    <p><strong>Especialidad:</strong> <span id="especialidad_display"></span></p>
                </h3>
                <input type="hidden" id="especialidad_id" />
                <input type="hidden" id="cita_id" />
                <input type="hidden" id="horario_original_id" />
                <input type="hidden" id="profesional_original_id" />
                <input type="hidden" id="sede_original_id" />

                <hr>
                <h3>Seleccione Nueva Cita</h3>
                <div class="form-group">
                    <label for="sede"><i class="fas fa-hospital"></i> Sede:</label>
                    <select id="sede" name="sede" required>
                        <option value="">Cargando Sedes...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="profesional"><i class="fas fa-user-md"></i> Profesional:</label>
                    <select id="profesional" name="profesional" required disabled>
                        <option value="">Seleccione Sede primero</option>
                    </select>
                    <div id="infoProfesional" class="info-profesional"></div>
                </div>
                <div class="form-group">
                    <label for="fecha_horario_display"><i class="fas fa-calendar-alt"></i> Fecha y Hora:</label>
                    <input type="text" id="fecha_horario_display" disabled placeholder="Seleccione un profesional">
                    <div id="horarios-list" style="display: none; margin-top: 10px;"></div>
                    <input type="hidden" id="horario_id" />
                </div>
                <div id="mensaje-modificacion" class="mensaje" role="status"></div>
                <div class="card-actions full-width margin-top">
                    <button id="nextToConfirmation" class="btn-accion btn-primary" disabled>Continuar</button>
                </div>
            </div>

            <div id="confirmationScreen" style="display: none;">
                <h3>Resumen de la Modificación</h3>
                <h4>Datos Originales</h4>
                <p><strong>Fecha/Hora:</strong> <span id="conf_original_datetime"></span></p>
                <p><strong>Profesional:</strong> <span id="conf_original_profesional"></span></p>
                <p><strong>Sede:</strong> <span id="conf_original_sede"></span></p>
                <hr>
                <h4>Nueva Cita Seleccionada</h4>
                <p><strong>Fecha/Hora:</strong> <span id="conf_modified_datetime" class="dato-resaltado"></span></p>
                <p><strong>Profesional:</strong> <span id="conf_modified_profesional" class="dato-resaltado"></span></p>
                <p><strong>Sede:</strong> <span id="conf_modified_sede" class="dato-resaltado"></span></p>
                <div class="card-actions full-width">
                    <button id="backToFormBtn" class="btn-accion btn-modificar">Volver a Seleccionar</button>
                    <button id="confirmModification" class="btn-accion btn-primary">Confirmar Modificación</button>
                </div>
            </div>
        </div>
    </div>

    <div id="notification-toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/es.js"></script>
    <script src="./../js/citas.js"></script>
    <script src="./../js/cancelacion.js"></script>
    <script src="../js/modificar_cita.js"></script>
    <script src="./../js/script_general.js"></script>
    <script src="./../js/notifications.js"></script>
    <script src="../js/session-manager.js"></script>
</body>

</html>